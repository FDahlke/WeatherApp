extends basicSite.pug

block jscript
  script(src='/js/scriptWeatherRoute.js')

  link(rel='stylesheet' href='https://unpkg.com/leaflet@1.7.1/dist/leaflet.css' integrity='sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==' crossorigin='')
  script(src='https://unpkg.com/leaflet@1.7.1/dist/leaflet.js' integrity='sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==' crossorigin='')
  script(src='https://cdn.jsdelivr.net/npm/chart.js')

  style.
    #map{height:45vh; width:100%;}

block content2
  .box
    input.button(type='button' value ='Update!' onClick="updateMap()")
    p#lat= lat 
    p#lon= lon
  .box#MapBox
  script(type='text/javascript').
    var marker 
    async function updateMap(){
      const url = "http://api.open-notify.org/iss-now.json"
      const resp = await fetch(url);

      if (!resp.ok) throw new Error(resp.statusText);
      const data = await resp.json();

      var lat =data.iss_position.latitude
      var lon =data.iss_position.longitude
      marker.setLatLng([lat,lon]);
    }
    function setMap() {
      const lat = document.getElementById("lat").textContent
      const lon = document.getElementById("lon").textContent
    document.getElementById("MapBox").innerHTML = '<div id="map"></div>';
    var map = L.map("map").setView([0, 0], 0);

    L.tileLayer("https://{s}.tile.osm.org/{z}/{x}/{y}.png", {
      attribution:
      '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);
    marker = L.marker([lat, lon]).addTo(map);
    }
    setMap();
    setInterval(function() {
        console.log("Updated Map")
        updateMap();
    }, 30000);
